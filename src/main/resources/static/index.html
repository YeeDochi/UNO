<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>game-hub/UNO!</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/style.css">
    <link rel="stylesheet" href="/UNO/card-style.css"> <!--카드 css-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/sockjs-client/1.5.1/sockjs.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/stomp.js/2.3.3/stomp.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.2/dist/confetti.browser.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;600&display=swap" rel="stylesheet">
    <link rel="icon" href="https://cdn.simpleicons.org/github/ffffff" type="image/svg+xml">
    <style>
        /* 공통 스타일 보강 */
        .hidden { display: none !important; }
        .game-stage {
            border: 1px solid var(--border-color);
            background: white;
            width: 600px; height: 500px;
            position: relative;
            border-radius: 6px;
            overflow: hidden;
        }
        /* 채팅창 등 기존 CSS 유지 */
        #chat-container { border: 1px solid var(--border-color); border-radius: 6px; background: var(--box-bg); display: flex; flex-direction: column; height: 500px; flex: 1; }
        #messages { flex: 1; overflow-y: auto; padding: 10px; font-size: 13px; }
        .msg-item { padding: 4px 0; border-bottom: 1px solid var(--border-color); }
        .msg-system { background: var(--bg-header); padding: 8px; border-radius: 6px; text-align: center; margin: 5px 0; color: var(--text-secondary); font-size: 12px; }
        .game-layout { display: flex; gap: 20px; }
        .room-item { padding: 12px 16px; border-bottom: 1px solid var(--border-color); display: flex; justify-content: space-between; align-items: center; cursor: pointer;}
        /* [추가] UNO 게임 스테이지 내부 레이아웃 */
        .game-stage {
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            background-color: var(--box-bg); /* 테마 배경색 적용 */
            border: 1px solid var(--border-color); /* 테마 테두리색 적용 */
            border-radius: 8px; /* 모서리 둥글게 */
            overflow: hidden; /* 내용 넘침 방지 */
        }

        /* 1. 상단: 상대방 영역 */
        #opponents-area {
            height: 80px;
            background: var(--box-bg); /* 테마 배경 */
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            padding: 0 10px;
        }

        /* 2. 중단: 테이블 (덱, 탑카드, 정보) */
        #table-area {
            flex: 1;
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 50px;
            /* 약간 어두운 패턴으로 테이블 느낌 내기 (테마 기반) */
            background-color: var(--box-bg);
            background-image: radial-gradient(var(--border-color) 1px, transparent 1px);
            background-size: 20px 20px;
            box-shadow: inset 0 0 20px rgba(0,0,0,0.05); /* 안쪽 그림자로 깊이감 */
        }

        /* 3. 하단: 내 패 영역 */
        #my-hand-area {
            height: 170px;
            background: var(--box-bg); /* 테마 배경 */
            border-top: 1px solid var(--border-color);
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 15px 10px;
            overflow-x: auto;
            /* 카드가 돋보이게 약간의 그림자 */
            box-shadow: 0 -2px 10px rgba(0,0,0,0.03);
        }

        /* 정보 박스 (색상, 턴) */
        .info-box {
            position: absolute;
            top: 15px; right: 15px;
            background: var(--box-bg);
            border: 1px solid var(--border-color);
            color: var(--text-primary);
            padding: 10px 15px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.05);
            text-align: right;
            font-size: 13px;
            min-width: 90px;
        }

        /* 덱 스타일 보강 */
        .deck-area {
            width: 84px; height: 124px; /* 카드보다 약간 크게 */
            border: 3px dashed var(--border-color);
            border-radius: 10px;
            background: rgba(0,0,0,0.02);
            display: flex; align-items: center; justify-content: center;
            cursor: pointer; font-weight: 600; color: var(--text-secondary);
            transition: 0.2s all;
        }
        .deck-area:hover {
            background: var(--box-bg);
            border-color: var(--link-color);
            color: var(--link-color);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        /* 턴 뱃지 */
        .turn-badge { background: #2da44e; color: white; padding: 3px 8px; border-radius: 12px; font-size: 12px; font-weight: 600; }
        .opponent-badge { background: var(--box-bg); border: 1px solid var(--border-color); color: var(--text-primary); padding: 5px 12px; border-radius: 20px; display: flex; align-items: center; gap: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        /* [추가] 랭킹 모달 스타일 */
        #overall-ranking-modal ul { list-style: none; padding: 0; margin: 0; }
        #overall-ranking-modal li { display: flex; justify-content: space-between; padding: 8px 12px; border-bottom: 1px solid var(--border-color); }
        #overall-ranking-modal li:last-child { border-bottom: none; }
        
        @media (max-width: 768px) {
        /* 1. 전체 레이아웃 & 여백 제거 */
        body, html { overflow-x: hidden; width: 100%; }
        /* 컨테이너 좌우 패딩을 최소화하여 화면을 넓게 씀 */
        .container { padding: 0 5px !important; width: 100%; box-sizing: border-box; }

        /* 2. [수정됨] 헤더: game-hub / UNO! 모두 표시 */
        header { padding: 8px 10px; gap: 5px; }
        .repo-breadcrumb { font-size: 15px; display: flex; align-items: center; flex-wrap: nowrap; }
        
        /* 숨겼던 repo-name과 구분자(/)를 다시 보이게 설정 */
        .repo-breadcrumb .user-name { display: inline-block !important; }
        .repo-breadcrumb .repo-name { display: inline-block !important; }
        .repo-breadcrumb span { display: inline-block !important; } /* 슬래시(/) */
        
        /* 공간이 부족하면 'Public' 뱃지만 숨김 (선택사항) */
        .badge { display: none !important; } 
        
        /* 로그인 정보는 좁은 화면에서 닉네임만 간단히 표시 */
        #loggedInArea span { max-width: 70px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }

        /* 3. [수정됨] 대기실 & 방 목록 박스 꽉 채우기 */
        /* width: 90% -> 100%로 변경하여 우측 빈 공간 제거 */
        .box { width: 100% !important; max-width: none; margin: 0 auto; }
        
        /* 방 목록 헤더 정렬 */
        #room-list-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        /* "방 목록" 글자 줄바꿈 방지 */
        #room-list-header span { white-space: nowrap; margin-right: 10px; }
        
        /* 버튼들이 한 줄을 꽉 채우도록 */
        #lobby-screen .box > div:nth-child(2) { flex-direction: column !important; gap: 8px !important; }
        #roomNameInput, #lobby-screen button { width: 100% !important; margin: 0 !important; box-sizing: border-box; }

        /* 4. 게임 화면 레이아웃 */
        .game-layout { flex-direction: column !important; gap: 15px; }
        .game-stage, #chat-container { width: 100% !important; max-width: 100%; box-sizing: border-box; }
        
        /* 카드 크기 최적화 */
        .card { width: 60px !important; height: 90px !important; }
        .card-center-text { font-size: 32px !important; }
        .card-corner-text { font-size: 12px !important; }
        .deck-area { width: 64px !important; height: 94px !important; font-size: 12px !important; }

        /* 테이블 영역 중앙 정렬 */
        #table-area { 
            flex-direction: column !important;
            gap: 10px !important;
            justify-content: center !important;
        }
        
        /* 카드 그룹 (덱+현재카드) 가로 배치 */
        .center-table-group {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            width: 100%;
        }

        /* 정보 박스 위치 조정 */
        .info-box { 
            position: static !important;
            margin-top: 5px;
            width: fit-content;
            margin: 5px auto 0 auto;
            display: flex; gap: 15px;
            background: rgba(0,0,0,0.03);
            box-shadow: none;
        }
        .info-box > div { margin: 0 !important; text-align: left !important; }
        
        #my-hand-area { height: 130px !important; padding: 10px 5px !important; }
        #chat-container { height: 400px !important; }
    }
    </style>
    <link rel="icon" href="https://cdn.simpleicons.org/github/ffffff" type="image/svg+xml">
</head>
<body>

<header>
    <div class="repo-breadcrumb">
        <img src="https://github.githubassets.com/images/modules/logos_page/GitHub-Mark.png" width="30" style="border-radius:50%; opacity:1;">
        <a href="/" class="user-name">game-hub</a>
        <span style="color:var(--text-primary)">/</span>
        <a href="#" class="repo-name">UNO!</a>
        <span class="badge">Public</span>
    </div>
    <div style="display: flex; gap: 8px; align-items: center; margin-left: auto;">
        <div id="loggedInArea" class="hidden" style="display: flex; align-items: center; gap: 8px;">
            <span style="color: var(--text-primary); font-size: 14px;">👋 <b id="userNickname">User</b></span>
            <button class="btn-default" onclick="Core.logout()" style="padding: 4px 8px; font-size: 12px;">Sign out</button>
        </div>
        <button class="theme-btn" onclick="Core.toggleTheme()">Dark/Light</button>
    </div>
</header>

<div id="alert-modal" class="hidden" style="position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); display:flex; justify-content:center; align-items:center; z-index:10000;">
    <div class="box" style="width:320px; margin: 0;">
        <div class="box-header">알림</div>
        <div style="padding: 20px; text-align: center;"><p id="alert-msg-text" style="margin:0;">메시지</p></div>
        <div style="padding:16px; border-top: 1px solid var(--border-color);">
            <button class="btn-primary" onclick="Core.closeAlert()" style="width: 100%;">확인</button>
        </div>
    </div>
</div>

<div id="confirm-modal" class="hidden" style="position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); display:flex; justify-content:center; align-items:center; z-index:10000;">
    <div class="box" style="width:320px; margin: 0;">
        <div class="box-header">확인</div>
        <div style="padding: 20px; text-align: center;"><p id="confirm-msg-text" style="margin:0;">진행?</p></div>
        <div style="padding:16px; border-top: 1px solid var(--border-color); display:flex; gap:10px;">
            <button class="btn-default" onclick="Core.closeConfirm()" style="flex:1;">취소</button>
            <button class="btn-primary" onclick="Core.confirmOk()" style="flex:1;">확인</button>
        </div>
    </div>
</div>
<div id="color-modal" class="hidden" style="position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); display:flex; justify-content:center; align-items:center; z-index:2000;">
    <div class="box" style="width:300px; padding: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.3);">
        <h3 style="margin-top:0; text-align:center;">🌈 색상 선택</h3>
        <p style="text-align:center; color:var(--text-secondary); font-size:13px; margin-bottom:15px;">와일드 카드의 색상을 정해주세요.</p>

        <div style="margin-bottom:20px;">
            <select id="color-select" style="width:100%; padding:10px; border:1px solid var(--border-color); border-radius:6px; background:var(--input-bg); color:var(--text-primary); font-size:14px;">
                <option value="RED">🔴 Red (빨강)</option>
                <option value="BLUE">🔵 Blue (파랑)</option>
                <option value="GREEN">🟢 Green (초록)</option>
                <option value="YELLOW">🟡 Yellow (노랑)</option>
            </select>
        </div>

        <div style="display:flex; gap:10px;">
            <button class="btn-default" onclick="closeColorModal()" style="flex:1;">취소</button>
            <button class="btn-primary" onclick="submitColorSelection()" style="flex:1;">확인</button>
        </div>
    </div>
</div>
<div id="login-screen" class="container" style="max-width: 400px; margin-top: 50px;">
    <div class="box">
        <div class="box-header">게임 입장</div>
        <div style="padding: 20px;">
            <label>닉네임</label>
            <input type="text" id="nicknameInput" placeholder="닉네임 입력" onkeypress="if(event.key==='Enter') Core.login()">
            <button class="btn-primary" onclick="Core.login()" style="width:100%; margin-top:20px;">입장하기</button>
        </div>
    </div>
</div>

<div id="lobby-screen" class="container hidden">
    <div class="box">
        <div class="box-header">대기실 <span id="welcome-msg" style="font-size:12px; font-weight:normal;"></span></div>
        <div style="padding: 16px; display:flex; gap:10px;">
            <input type="text" id="roomNameInput" placeholder="방 제목" value="새로운 게임방" style="flex:2;">
            <div id="game-options-area"></div>
            <button class="btn-primary" onclick="Core.createRoom()">방 만들기</button>
            <button class="btn-default" onclick="Core.showRanking()">🏆 랭킹</button>
        </div>
        <div style="max-height: 400px; overflow-y: auto;">
            <div id="room-list-header" style="padding: 10px 16px; background:var(--bg-header); border-bottom:1px solid var(--border-color); display:flex; justify-content:space-between;">
                    <span>방 목록</span>
                <button class="btn-default" onclick="Core.loadRooms()" style="font-size:12px;"><i class="fas fa-sync-alt"></i> 새로고침</button>
            </div>
            <ul id="room-list" style="list-style: none; padding: 0; margin: 0;"></ul>
        </div>
    </div>
</div>

<div id="game-screen" class="container hidden">
    <div class="game-meta" style="display:flex; justify-content:space-between; margin-bottom:10px; align-items:center;">
        <div>
            <strong id="room-title-text" style="font-size: 18px;">방 제목</strong>
            <span id="game-status" class="badge">대기 중</span>
        </div>
        <div id="custom-header-area"></div>
        <div>
            <button id="startBtn" class="btn-primary" onclick="Core.startGame()">게임 시작</button>
            <button class="btn-danger" onclick="Core.exitRoom()">나가기</button>
        </div>
    </div>

    <div id="game-tools-area" style="margin-bottom:10px;"></div>

    <div class="game-layout">

        <div id="game-stage" class="game-stage">

            <div id="opponents-area">
                <span style="color:#999; font-size:13px;">접속 대기 중...</span>
            </div>

        <div id="table-area">
            <div class="center-table-group">
                <div class="deck-area" onclick="reqDrawCard()">
                    <div style="text-align:center;">DRAW<br>PILE</div>
                </div>
                <div id="top-card-area">
                </div>
            </div>

            <div class="info-box">
                <div style="color:#666; font-size:11px;">Color</div>
                <div id="info-color" style="font-size:16px; font-weight:bold; margin-bottom:4px;">-</div>
                <div style="color:#666; font-size:11px;">Turn</div>
                <div id="info-turn" style="font-weight:600;">-</div>
            </div>
        </div>

            <div id="my-hand-area" class="hand-container overlap">
            </div>
        </div>

        <div id="chat-container">
            <div class="box-header" style="padding: 8px;">채팅</div>
            <div id="messages"></div>
            <div style="padding: 10px; border-top: 1px solid var(--border-color); display:flex; gap:5px;">
                <button class="btn-default" onclick="Core.openImageModal()" style="padding: 0 8px; margin-right:5px;" title="이미지 전송">
                    <i class="fas fa-images"></i>
                </button>
                <input type="text" id="chatInput" style="flex: 1;" placeholder="입력..." onkeypress="if(event.key==='Enter') Core.sendChat()">
                <button class="btn-primary" onclick="Core.sendChat()">전송</button>
            </div>
        </div>
        <div id="image-modal" class="hidden" style="position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:9999; display:flex; justify-content:center; align-items:center;">
            <div class="box" style="width: 500px; height: 600px; display:flex; flex-direction:column; background:var(--box-bg); padding:0; margin:0;">

                <div style="padding:15px; border-bottom:1px solid var(--border-color); display:flex; justify-content:space-between; align-items:center;">
                    <div style="display:flex; align-items:center; gap: 15px;">
                        <strong style="font-size: 1.1em;">이미지 갤러리</strong>

                        <label style="cursor: pointer; user-select: none; font-size: 13px; color: var(--text-secondary); display:flex; align-items:center; white-space: nowrap;">
                            <input type="checkbox" id="starFilterCheckbox" onchange="Core.loadImages()" style="margin-right: 5px;">
                            <span>★ 즐겨찾기만</span>
                        </label>
                    </div>

                    <button onclick="Core.closeImageModal()" style="background:none; border:none; color:var(--text-primary); cursor:pointer; font-size:1.5em; line-height:1;">&times;</button>
                </div>

                <div style="padding:15px; border-bottom:1px solid var(--border-color); background:rgba(0,0,0,0.02);">
                    <div style="display:flex; gap:5px; margin-bottom:10px;">
                        <input type="text" id="linkInput" placeholder="이미지 주소(URL) 붙여넣기" style="flex:1; padding:8px; border:1px solid var(--border-color); border-radius:4px;">
                        <button class="btn-primary" onclick="Core.addExternalLink()" style="width:80px;">등록</button>
                    </div>

                    <input type="file" id="uploadInput" accept="image/*" style="display:none;" onchange="Core.uploadFile(this)">
                    <button class="btn-default" onclick="document.getElementById('uploadInput').click()" style="width:100%; padding:8px; border:1px dashed var(--text-secondary); color: var(--text-secondary);">
                        <i class="fas fa-plus"></i> 내 컴퓨터에서 업로드
                    </button>
                </div>

                <div id="gallery-area" style="flex:1; padding:15px; overflow-y:auto; background: var(--box-bg);">
                    <div id="server-img-list" style="display:grid; grid-template-columns: repeat(3, 1fr); gap:8px;">
                    </div>
                </div>

            </div>
        </div>
    </div>
</div>

<div id="ranking-modal" class="hidden" style="position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); display:flex; justify-content:center; align-items:center; z-index:999;">
    <div class="box" style="width:360px; text-align: center;">
        <div class="box-header">🏆 게임 결과</div>
        <div style="padding: 30px 20px;">
            <img id="winnerImage" src="" style="width:100px; height:100px; border-radius:50%; margin-bottom:10px; border:3px solid #2da44e;">
            <div id="winnerName" style="font-size:20px; font-weight:bold;">WINNER</div>
        </div>
        <div style="padding:16px; border-top: 1px solid var(--border-color);">
            <button class="btn-primary" onclick="Core.closeRanking()" style="width: 100%;">나가기</button>
        </div>
    </div>
</div>

<div id="leaderboard-modal" class="hidden" style="position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); display:flex; justify-content:center; align-items:center; z-index:2000;">
    <div class="box" style="width:400px; margin: 0; display:flex; flex-direction:column; max-height:80vh;">
        <div class="box-header" style="display:flex; justify-content:space-between; align-items:center; background: #ffd43b; color: #333;">
            <span>🏆 TOP 5 명예의 전당</span>
            <button onclick="Core.closeLeaderboard()" style="background:none; border:none; color:#333; font-size:16px; cursor:pointer;">&times;</button>
        </div>
        <div style="padding:10px;">
            <table class="score-table" style="width:100%;">
                <thead>
                <tr>
                    <th style="width:15%; text-align:center;">순위</th>
                    <th style="text-align:left;">닉네임</th>
                    <th style="width:25%; text-align:right;">점수</th>
                </tr>
                </thead>
                <tbody id="ranking-list-body">
                </tbody>
            </table>
        </div>
        <div style="padding:16px; border-top: 1px solid var(--border-color); text-align:center;">
            <button class="btn-primary" onclick="Core.closeLeaderboard()" style="width: 100%;">닫기</button>
        </div>
    </div>
</div>

<script src="/UNO/js/game-core.js"></script>
<script src="/UNO/js/card-core.js"></script>
<script src="/UNO/js/uno.js"></script>
</body>
</html>